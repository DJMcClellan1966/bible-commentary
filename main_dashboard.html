<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bible Study App - Main Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
            padding: 40px 20px;
        }

        .header h1 {
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.3em;
            opacity: 0.95;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .feature-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
            text-decoration: none;
            color: inherit;
            display: block;
        }

        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
        }

        .feature-card h2 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.8em;
        }

        .feature-card p {
            color: #666;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .feature-card .badge {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85em;
            margin-top: 10px;
        }

        .section-title {
            color: white;
            font-size: 2em;
            margin: 40px 0 20px 0;
            text-align: center;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .stats {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 30px;
            color: white;
            text-align: center;
            margin-bottom: 40px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .stat-item {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 10px;
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 1em;
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìñ Bible Study App</h1>
            <p>Your Complete Bible Study Companion</p>
        </div>

        <div class="stats" id="stats">
            <h2>Library Statistics</h2>
            <div class="stats-grid" id="stats-grid">
                <div class="stat-item">
                    <div class="stat-number">-</div>
                    <div class="stat-label">Books in Library</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">-</div>
                    <div class="stat-label">Categories</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">-</div>
                    <div class="stat-label">Total Words</div>
                </div>
            </div>
        </div>

        <h2 class="section-title">Main Features</h2>
        <div class="features-grid">
            <a href="/understanding" class="feature-card">
                <h2>üß† Understanding Bible</h2>
                <p>See Scripture through the eyes of great theological thinkers: Aquinas, Pope Benedict, Tim Keller, and more. Discover the depth that great minds find in Scripture.</p>
                <span class="badge">Deep Insights</span>
            </a>

            <a href="/journey" class="feature-card">
                <h2>üõ§Ô∏è Relationship Journey</h2>
                <p>A personalized Bible journey focused on building your relationship with God. Ask questions, explore connections, and build your personal verse collection.</p>
                <span class="badge">Personal Journey</span>
            </a>

            <a href="/bible" class="feature-card">
                <h2>üìñ Hyperlinked Bible</h2>
                <p>Read the Bible with automatic cross-references and AI-generated summaries. Every verse links to related verses throughout Scripture.</p>
                <span class="badge">Interactive Reading</span>
            </a>
        </div>

        <h2 class="section-title">Book Library</h2>
        <div class="features-grid">
            <a href="/library" class="feature-card">
                <h2>üìö Book Library</h2>
                <p>Access your complete library of AI-generated books: Bible Mysteries, Red Letters, Book-by-Book Studies, and more. Over 70 books available.</p>
                <span class="badge">70+ Books</span>
            </a>

            <a href="#" class="feature-card" onclick="event.preventDefault(); showBooksByCategory('Old Testament Studies');">
                <h2>üìú Old Testament Studies</h2>
                <p>Comprehensive studies for all 39 Old Testament books. Deep understanding of each book's themes, purpose, and connections.</p>
                <span class="badge">39 Studies</span>
            </a>

            <a href="#" class="feature-card" onclick="event.preventDefault(); showBooksByCategory('New Testament Studies');">
                <h2>‚úùÔ∏è New Testament Studies</h2>
                <p>Complete studies for all 27 New Testament books. Explore the Gospels, Epistles, and Revelation in depth.</p>
                <span class="badge">27 Studies</span>
            </a>

            <a href="#" class="feature-card" onclick="event.preventDefault(); showBooksByCategory('Biblical Mysteries');">
                <h2>üîÆ Bible Mysteries</h2>
                <p>Explore the mysteries of the Bible: Trinity, Incarnation, Atonement, and more. 20 chapters of deep exploration.</p>
                <span class="badge">20 Chapters</span>
            </a>

            <a href="#" class="feature-card" onclick="event.preventDefault(); showBooksByCategory('Jesus Teachings');">
                <h2>‚ù§Ô∏è Red Letters</h2>
                <p>Explore Jesus' words from the Gospels and how they reveal the way to relationship with God. 20 chapters of insight.</p>
                <span class="badge">20 Chapters</span>
            </a>
        </div>

        <h2 class="section-title">Advanced Features</h2>
        <div class="features-grid">
            <a href="/docs" class="feature-card">
                <h2>üîå API Documentation</h2>
                <p>Full API documentation with interactive testing. Access all features programmatically.</p>
                <span class="badge">Developer Tools</span>
            </a>

            <a href="#" class="feature-card" onclick="event.preventDefault(); alert('Run: python blow_your_mind.py');">
                <h2>üí• Mind-Blowing Insights</h2>
                <p>See how one verse connects to the ENTIRE biblical narrative. Discover the infinite depth of Scripture.</p>
                <span class="badge">Deep Analysis</span>
            </a>
        </div>
    </div>

    <script>
        const API_BASE = window.location.origin;

        async function loadLibrary() {
            try {
                const response = await fetch(`${API_BASE}/api/library/statistics`);
                const stats = await response.json();
                
                document.getElementById('stats-grid').innerHTML = `
                    <div class="stat-item">
                        <div class="stat-number">${stats.total_books || 0}</div>
                        <div class="stat-label">Books in Library</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">${stats.categories ? stats.categories.length : 0}</div>
                        <div class="stat-label">Categories</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">${stats.total_words ? (stats.total_words / 1000).toFixed(0) + 'K' : '0'}</div>
                        <div class="stat-label">Total Words</div>
                    </div>
                `;

                // Show library books
                const booksResponse = await fetch(`${API_BASE}/api/library/books`);
                const booksData = await booksResponse.json();
                
                if (booksData.books && booksData.books.length > 0) {
                    showBookList(booksData.books);
                }
            } catch (error) {
                console.error('Error loading library:', error);
            }
        }

        async function showBooksByCategory(category) {
            try {
                const response = await fetch(`${API_BASE}/api/library/books`);
                const data = await response.json();
                
                const books = data.books.filter(book => book.category === category);
                
                if (books.length > 0) {
                    showBookList(books, category);
                } else {
                    alert(`No books found in category: ${category}`);
                }
            } catch (error) {
                console.error('Error loading books:', error);
            }
        }

        function showBookList(books, category = 'All Books') {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                z-index: 1000;
                overflow-y: auto;
                padding: 20px;
            `;
            
            modal.innerHTML = `
                <div style="max-width: 800px; margin: 0 auto; background: white; border-radius: 15px; padding: 30px;">
                    <h2 style="margin-bottom: 20px; color: #667eea;">${category}</h2>
                    <div style="max-height: 600px; overflow-y: auto;">
                        ${books.map(book => `
                            <div style="padding: 15px; border-bottom: 1px solid #eee; cursor: pointer;" 
                                 onclick="openBook(${book.id})">
                                <h3 style="color: #667eea; margin-bottom: 5px;">${book.title}</h3>
                                <p style="color: #666; font-size: 0.9em;">${book.description || 'No description'}</p>
                                <span style="color: #999; font-size: 0.85em;">${book.category} ‚Ä¢ ${book.word_count || 0} words</span>
                            </div>
                        `).join('')}
                    </div>
                    <button onclick="this.closest('div').parentElement.remove()" 
                            style="margin-top: 20px; padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer;">
                        Close
                    </button>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        async function openBook(bookId) {
            try {
                const response = await fetch(`${API_BASE}/api/library/books/${bookId}`);
                const data = await response.json();
                
                const modal = document.createElement('div');
                modal.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0,0,0,0.9);
                    z-index: 2000;
                    overflow-y: auto;
                    padding: 20px;
                `;
                
                const content = data.content || data.book?.content || 'Content not available';
                const title = data.book?.title || 'Book';
                
                modal.innerHTML = `
                    <div style="max-width: 900px; margin: 0 auto; background: white; border-radius: 15px; padding: 30px;">
                        <h2 style="margin-bottom: 20px; color: #667eea;">${title}</h2>
                        <div style="max-height: 80vh; overflow-y: auto; line-height: 1.8; color: #333;">
                            ${typeof content === 'string' ? content.replace(/\n/g, '<br>') : JSON.stringify(content, null, 2)}
                        </div>
                        <button onclick="this.closest('div').parentElement.remove()" 
                                style="margin-top: 20px; padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer;">
                            Close
                        </button>
                    </div>
                `;
                
                document.body.appendChild(modal);
            } catch (error) {
                console.error('Error opening book:', error);
                alert('Could not load book. Error: ' + error.message);
            }
        }

        // Load stats on page load
        window.addEventListener('load', () => {
            loadLibrary();
        });
    </script>
</body>
</html>